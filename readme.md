# Project Title

> **This is a template repo.** Customize this README for your specific project. See `HOW-TO-USE-THIS.md` for setup instructions.

> Replace this with your actual project title. Include enough detail that someone can understand what this project is about.

## Introduction

> Brief description of the project background, questions, hypothesis, rationale, and goals.

## Project Details

**Project Name:** `your_project_name_YYYYMMDD`

**GitHub Repository:** `https://github.com/umn-msi-lmnp/GROUP_USER_your_project_name_YYYYMMDD`

**MSI Location:** `/projects/standard/GROUP/shared/ris/USER/your_project_name_YYYYMMDD`

**Project Start Date:** YYYY-MM-DD

## Contacts

- **PI:** Name (PI role and group)
- **Analyst:** Name (MSI bioinformatics analyst)
- **Collaborators:** Names and roles

## Data Locations

### Raw Data

> Document where raw data is stored. These are generally FASTQ files. Include the original UMGC data_delivery path, a Tier 2 backup path (if available), or disaster_recovery path (if available).

### Analyzed Data

Project directory on MSI Tier 1:
```
/projects/standard/GROUP/shared/ris/USER/your_project_name_YYYYMMDD
```


Project backup/archive on MSI Tier 2:
```
s3cmd ls s3://BUCKET/projects/standard/GROUP/shared/ris/USER/your_project_name_YYYYMMDD
```

## Project Structure

| Directory           | Description                                                                                              |
| ------------------- | -------------------------------------------------------------------------------------------------------- |
| `code/`             | Analysis scripts and code (version controlled)                                                           |
| `code_out/`         | Analysis outputs generated by scripts in `code/` (not in git, reproducible from `code/`)                 |
| `input/`            | Input files or symlinks to input data                                                                    |
| `meta/`             | Project metadata (grants, papers, presentations, protocols, non-tidy sample sheets, etc.)                |
| `software/`         | Build scripts for reproducible software environments (version controlled)                                |
| `software_out/`     | Built software environments (not in git, reproducible from `software/`)                                  |
| `.apptainer/`       | Apptainer build cache (not in git, could be deleted, not required)                                       |
| `changelog.md`      | Chronological log of project changes, notes, to-dos                                                      |
| `readme.md`         | This file - project overview and documentation                                                           |
| `HOW-TO-USE-THIS.md`| Template documentation (delete after setup or keep for reference)                                        |

## Quick Start - Getting Up and Running

> **Note:** Software environments must be built before running analyses. See `HOW-TO-USE-THIS.md` for detailed setup instructions.

### 1. Build Software Environments

```bash
# Build miniforge (required - provides conda)
cd software
sbatch 010_minforge.slurm

# Wait for miniforge to complete, then build conda environments
sbatch 011_conda1.slurm    # Main R & Python environment
sbatch 012_conda2.slurm    # Secondary environment (if needed)

# Build/download containers (optional)
sbatch 021_apptainer1.slurm  # Custom container
sbatch 031_deepvariant.slurm # Downloaded container
```

**Alternative:** Run as bash scripts instead of submitting to SLURM:
```bash
cd software
bash 010_minforge.slurm
bash 011_conda1.slurm
```

### 2. Work on an analysis interactively via the command line

```bash
# Navigate to your project's code dir
cd code

# You must source this script to activate the conda/miniforge installation
source ../software_out/010_miniforge/use_miniforge.sh
conda activate conda1

# Start your analysis (e.g. via R, or python)
R
python
```

### 3. Launch analysis scripts using slurm

```bash
cd code
sbatch demo_analysis.slurm
```
### 4. Start an Open OnDemand RStudio session

- Visit [https://ondemand.msi.umn.edu](https://ondemand.msi.umn.edu)
- Start an RStudio Server Interactive session
    - Choose MSI account
    - Choose resources
    - Choose R version: None (Custom Environment Provided)
    - Check the Customize Environment box
    - Enter the following into the Custom Environment text box (replace with your actual project path), and then click Launch.

```bash
source /projects/standard/GROUP/shared/ris/USER/PROJECT_NAME/software_out/010_miniforge/use_miniforge.sh
conda activate conda1
```



## Software Environments

This project uses self-contained, reproducible software environments built from scripts in `software/`:

- **Conda environments** (`01x` series): R, Python, and bioinformatics packages
- **Custom containers** (`02x` series): Built from definition files
- **Downloaded containers** (`03x` series): Pre-built from registries

**Key Features:**
- Complete isolation from home directory packages
- Per-environment R configuration (no `~/R/` or `~/.Renviron` interference)
- Reproducible from version-controlled build scripts
- Can delete `software_out/` and rebuild from scratch
- Auto-detecting PROJECT_ROOT paths (manual override available if needed)

**Built outputs:** `software_out/` (not in git, regenerated from `software/` scripts)

See `HOW-TO-USE-THIS.md` for detailed documentation.



## Results

> Briefly describe the analyses performed in this project. Link to specific scripts or outputs. Alternatively, link to a Google Doc or other files used to track progress. Describe where results/reports can be found (Google Docs, output directories, generated HTML reports, etc.)

## Troubleshooting

### Scripts fail with path errors

All scripts auto-detect PROJECT_ROOT. If auto-detection fails, manually set PROJECT_ROOT:

```bash
# Add this line after the slurm_script_dir() function in any script
PROJECT_ROOT="/full/path/to/your/project"
```

### Environment rebuild issues

To rebuild an environment cleanly, simply re-run the build script:
```bash
sbatch software/011_conda1.slurm
```

This automatically:
- Renames the old output directory with a timestamp suffix
- Deletes and rebuilds the conda environment from scratch
- Creates fresh activation hooks and configuration files

See `HOW-TO-USE-THIS.md` for more details.

## Changelog

See `changelog.md` for a detailed chronological log of project activities and changes.
